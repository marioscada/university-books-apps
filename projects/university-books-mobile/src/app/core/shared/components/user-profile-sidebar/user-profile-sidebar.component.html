<!-- Backdrop Overlay -->
<div
  [@fadeIn]
  class="backdrop"
  role="button"
  tabindex="0"
  [attr.aria-label]="'Close user profile'"
  (click)="onClose()"
  (keydown.enter)="onClose()"
  (keydown.escape)="onClose()"
></div>

<!-- Right Sidebar (GitHub Style) -->
<aside
  [@slideInRight]
  class="profile-sidebar"
  [attr.aria-label]="'User profile menu'"
>
  <!-- User Info Header -->
  <div class="user-header">
    @if (currentView() === 'account') {
      <button
        class="back-btn"
        type="button"
        aria-label="Back"
        (click)="backToMenu()"
      >
        <ion-icon
          name="arrow-back"
          class="back-icon"
        ></ion-icon>
      </button>
    }

    <button
      class="close-btn"
      type="button"
      aria-label="Close"
      (click)="onClose()"
    >
      <ion-icon
        name="close"
        class="close-icon"
      ></ion-icon>
    </button>

    <div class="user-info">
      <ion-icon
        name="person-circle"
        class="user-avatar"
      ></ion-icon>
      @if (displayName()) {
        <div class="user-name">{{ displayName() }}</div>
      }
    </div>
  </div>

  <!-- Menu View -->
  @if (currentView() === 'menu') {
    <div class="menu-content">
      <!-- Menu Items -->
      <div class="menu-section">
        <button
          class="menu-item clickable"
          type="button"
          (click)="showAccount()"
        >
          <ion-icon
            name="person-outline"
            class="item-icon"
          ></ion-icon>
          <span>Account</span>
        </button>

        <button
          class="menu-item clickable"
          type="button"
        >
          <ion-icon
            name="settings-outline"
            class="item-icon"
          ></ion-icon>
          <span>Settings</span>
        </button>
      </div>

      <div class="menu-divider"></div>

      <!-- Logout Section -->
      @if (logoutState$ | async; as logoutState) {
        <div class="menu-section">
          @if (logoutState.error) {
            <div class="alert alert-error">{{ logoutState.error }}</div>
          }
          <button
            class="menu-item clickable logout-item"
            type="button"
            [disabled]="logoutState.loading"
            (click)="onLogout()"
          >
            <ion-icon
              name="log-out-outline"
              class="item-icon"
            ></ion-icon>
            <span>{{ logoutState.loading ? 'Signing out...' : 'Sign out' }}</span>
          </button>
        </div>
      }
    </div>
  }

  <!-- Account View -->
  @if (currentView() === 'account') {
    <div class="menu-content">
      <div class="menu-section">
        @if (user(); as userData) {
          @if (userData.givenName) {
            <div class="menu-item info-item">
              <span class="item-label">First Name</span>
              <span class="item-value">{{ userData.givenName }}</span>
            </div>
          }
          @if (userData.familyName) {
            <div class="menu-item info-item">
              <span class="item-label">Last Name</span>
              <span class="item-value">{{ userData.familyName }}</span>
            </div>
          }
          @if (userData.email) {
            <div class="menu-item info-item">
              <span class="item-label">Email</span>
              <span class="item-value">{{ userData.email }}</span>
            </div>
          }
          @if (userData.emailVerified !== undefined) {
            <div class="menu-item info-item">
              <span class="item-label">Status</span>
              <span class="item-value">
                <ion-icon
                  [name]="userData.emailVerified ? 'checkmark-circle' : 'close-circle'"
                  [class.verified-icon]="userData.emailVerified"
                  [class.unverified-icon]="!userData.emailVerified"
                ></ion-icon>
                {{ userData.emailVerified ? 'Verified' : 'Not verified' }}
              </span>
            </div>
          }
        }
      </div>
    </div>
  }
</aside>
