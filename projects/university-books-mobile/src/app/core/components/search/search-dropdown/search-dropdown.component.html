<div
  class="search-dropdown"
  role="dialog"
  aria-label="Search dialog"
  (keydown)="onKeydown($event)"
>
  <!-- Header -->
  <div class="search-dropdown-header">
    <ion-searchbar
      class="search-input"
      mode="md"
      animated
      autocomplete="off"
      autocorrect="off"
      spellcheck="false"
      [placeholder]="placeholder"
      [value]="searchQuery$ | async"
      (ionInput)="onSearchInput($event)"
    ></ion-searchbar>

    <button
      class="close-btn"
      type="button"
      aria-label="Close search"
      (click)="close()"
    >
      <ion-icon
        class="close-icon"
        name="close-outline"
      ></ion-icon>
    </button>
  </div>

  <!-- Results -->
  <div class="search-dropdown-body">
    <!-- Empty state -->
    @if (showEmpty$ | async) {
      <div class="search-empty">
        <ion-icon
          class="empty-icon"
          name="search-outline"
        ></ion-icon>
        <p class="empty-message">{{ emptyMessage }}</p>
      </div>
    }

    <!-- No results -->
    @if (showNoResults$ | async) {
      <div class="search-no-results">
        <ion-icon
          class="empty-icon"
          name="search-outline"
        ></ion-icon>
        <p class="empty-message">{{ noResultsMessageFormatted$ | async }}</p>
        <p class="empty-hint">{{ noResultsHint }}</p>
      </div>
    }

    <!-- Results grouped by category (GitHub-style) -->
    @if (categoriesWithItems$ | async; as categories) {
      @if (categories.length > 0) {
        <div class="search-results" role="listbox">
          @for (category of categories; track category.config.key) {
            <div class="search-category">
              <!-- Category header -->
              <div class="category-header">
                <ion-icon
                  class="category-icon"
                  [name]="category.config.icon"
                ></ion-icon>
                <span class="category-label">{{ category.config.label }}</span>
                <span class="category-count">({{ category.items.length }})</span>
              </div>

              <!-- Category items -->
              <div class="category-items">
                @for (item of category.items; track item.id) {
                  <app-search-item
                    [item]="item"
                    [jumpToHint]="jumpToHint"
                    (selected)="onItemSelect($event)"
                  ></app-search-item>
                }
              </div>
            </div>
          }
        </div>
      }
    }
  </div>
</div>
