<div class="forgot-password-container">
  <div class="forgot-password-card">
    <h1 class="forgot-password-title">Reset Password</h1>
    <p class="forgot-password-subtitle">
      @if (step() === 'email') {
        Enter your email to receive a verification code
      } @else {
        Enter the code sent to your email
      }
    </p>

    <!-- Step 1: Request Code -->
    @if (step() === 'email') {
      <form [formGroup]="emailForm" (ngSubmit)="onRequestCode()" class="forgot-password-form">
        <div class="form-group">
          <label for="email">Email</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            placeholder="you@example.com"
            [class.error]="emailControl?.invalid && emailControl?.touched"
          />
          @if (emailControl?.invalid && emailControl?.touched) {
            <div class="error-message">
              @if (emailControl?.errors?.['required']) {
                <span>Email is required</span>
              }
              @if (emailControl?.errors?.['email']) {
                <span>Please enter a valid email</span>
              }
            </div>
          }
        </div>

        <!-- Error Message -->
        @if (errorMessage()) {
          <div class="alert alert-error">
            {{ errorMessage() }}
          </div>
        }

        <!-- Success Message -->
        @if (successMessage()) {
          <div class="alert alert-success">
            {{ successMessage() }}
          </div>
        }

        <button
          type="submit"
          class="btn-primary"
          [disabled]="loading() || emailForm.invalid"
        >
          @if (loading()) {
            <span class="spinner"></span>
            <span>Sending code...</span>
          } @else {
            <span>Send Code</span>
          }
        </button>
      </form>
    }

    <!-- Step 2: Reset Password -->
    @if (step() === 'code') {
      <form [formGroup]="resetForm" (ngSubmit)="onResetPassword()" class="forgot-password-form">
        <div class="form-group">
          <label for="code">Verification Code</label>
          <input
            id="code"
            type="text"
            formControlName="code"
            placeholder="Enter 6-digit code"
            [class.error]="code?.invalid && code?.touched"
          />
          @if (code?.invalid && code?.touched) {
            <div class="error-message">
              @if (code?.errors?.['required']) {
                <span>Code is required</span>
              }
              @if (code?.errors?.['minlength']) {
                <span>Code must be 6 digits</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input
            id="newPassword"
            type="password"
            formControlName="newPassword"
            placeholder="Enter new password"
            [class.error]="newPassword?.invalid && newPassword?.touched"
          />
          @if (newPassword?.invalid && newPassword?.touched) {
            <div class="error-message">
              @if (newPassword?.errors?.['required']) {
                <span>Password is required</span>
              }
              @if (newPassword?.errors?.['minlength']) {
                <span>Password must be at least 12 characters</span>
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="confirmPassword">Confirm Password</label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            placeholder="Re-enter new password"
            [class.error]="(confirmPassword?.invalid && confirmPassword?.touched) || passwordMismatch"
          />
          @if (confirmPassword?.invalid && confirmPassword?.touched) {
            <div class="error-message">
              @if (confirmPassword?.errors?.['required']) {
                <span>Please confirm your password</span>
              }
            </div>
          }
          @if (passwordMismatch) {
            <div class="error-message">
              <span>Passwords do not match</span>
            </div>
          }
        </div>

        <!-- Error Message -->
        @if (errorMessage()) {
          <div class="alert alert-error">
            {{ errorMessage() }}
          </div>
        }

        <!-- Success Message -->
        @if (successMessage()) {
          <div class="alert alert-success">
            {{ successMessage() }}
          </div>
        }

        <button
          type="submit"
          class="btn-primary"
          [disabled]="loading() || resetForm.invalid"
        >
          @if (loading()) {
            <span class="spinner"></span>
            <span>Resetting password...</span>
          } @else {
            <span>Reset Password</span>
          }
        </button>

        <button
          type="button"
          class="btn-secondary"
          (click)="step.set('email')"
          [disabled]="loading()"
        >
          Back
        </button>
      </form>
    }

    <!-- Footer -->
    <div class="forgot-password-footer">
      <p><a routerLink="/auth/login">Back to Sign In</a></p>
    </div>
  </div>
</div>
